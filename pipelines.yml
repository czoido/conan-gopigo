resources:
  - name: conan_gopigo_github
    type: GitRepo
    configuration:
      path: czoido/conan-gopigo
      gitProvider: czoido_github

pipelines:
  - name: conan_gopigo
    steps:
      - name: test_step
        type: Bash
        configuration:
          runtime:
            type: image
            image:
              custom:
                name: conanio/gcc6-armv7hf
                tag: latest
          inputResources:
            - name: conan_gopigo_github
          integrations:
            - name: czoido_docker
        execution:
          onExecute:
            - ls -l
            - python build.py
      - name: build_docker_image
        type: DockerBuild
        configuration:
          affinityGroup: dockerGroup
          dockerFileLocation: .
          dockerFileName: Dockerfile
          dockerImageName: art-yalla.jfrog-lab.com:443/yalla-gopigo
          dockerImageTag: $run_number
          inputResources:
            - name: conan_gopigo_github
          integrations:
            - name: artifactory
      - name: push_docker_image
        type: DockerPush
        configuration:
          affinityGroup: dockerGroup
          targetRepository: docker
          integrations:
            - name: artifactory
          inputSteps:
            - name: build_docker_image
        execution:
          onStart:
            - echo "Preparing for work..."
          onSuccess:
            - echo "Job well done!"
          onFailure:
            - echo "uh oh, something went wrong"
          onComplete:
            - echo "Cleaning up some stuff"
      - name: build_gopigo_package
        type: Bash
        configuration:
          runtime:
            type: image
            image:
              custom:
                name: art-yalla.jfrog-lab.com/docker-local/gopigo
                tag: $run_number
          inputSteps:
            - name: push_docker_image
          integrations:
            - name: artifactory
        execution:
          onExecute:
            - ls -l
            - python build.py
      - name: print_information
        type: Bash
        configuration:
          inputSteps:
            - name: build_gopigo_package
        execution:
          onExecute:
            - ls -l
            - printenv
            - echo $res_conan_gopigo_github_commitSha          

